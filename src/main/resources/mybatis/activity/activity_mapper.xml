<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="gdsc.netwalk.mapper.activity.ActivityMapper">

    <insert id="registerActivity" parameterType="gdsc.netwalk.common.vo.CustomMap"
			useGeneratedKeys="true" keyProperty="act_no" keyColumn="act_no">
		<![CDATA[
			INSERT INTO ACTIVITY_TB
				(
					USER_NO,
					GROUP_NO,
					TOTAL_ACT_DISTANCE,
					TOTAL_ACT_TIME,
					SHARE_ST,
					REG_DT,
					MOD_DT
				)
			VALUES
				(
					#{user_no},
					#{group_no},
					#{total_act_distance},
					#{total_act_time},
					#{share_st},
					NOW(),
					NOW()
				);
		]]>
	</insert>

	<insert id="registerActivityDistance" parameterType="gdsc.netwalk.common.vo.CustomMap">
		<![CDATA[
			INSERT INTO ACTIVITY_DISTANCE_TB
				(
					ACT_NO,
					LATITUDE,
					LONGITUDE
				)
			VALUES
		]]>
		<foreach item="degree" collection="distances" separator=",">
			(
			 	#{act_no},
			 	#{degree.latitude},
				#{degree.longitude}
			 )
		</foreach>

	</insert>

	<select id="selectActivityByUser" parameterType="gdsc.netwalk.common.vo.CustomMap" resultType="gdsc.netwalk.common.vo.CustomMap">
		<![CDATA[
			SELECT
				ACT_NO AS act_no,
				GROUP_NO AS group_no,
				TOTAL_ACT_DISTANCE AS total_act_distance,
				TOTAL_ACT_TIME AS total_act_time,
				SHARE_ST AS share_st,
				DATE_FORMAT(REG_DT, "%Y-%m-%d") AS reg_dt
			FROM ACTIVITY_TB
			WHERE USER_NO = #{user_no};
		]]>
	</select>

	<select id="selectActivityDistanceByUser" parameterType="int" resultType="gdsc.netwalk.common.vo.CustomMap">
		<![CDATA[
			SELECT
				LATITUDE AS latitude,
				LONGITUDE AS longitude
			FROM ACTIVITY_DISTANCE_TB
			WHERE ACT_NO = #{act_no};
		]]>
	</select>
</mapper>